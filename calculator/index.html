<html>
    <head>
        <title>Balloon ascent calculator</title>
        <link rel="stylesheet" href="css/bootstrap-3.3.2-custom.css"/>
        <link rel="stylesheet" href="css/bootstrap-theme-3.3.2-custom.css"/>
        <style>
            body {
                background-color: #04394d;
            }
            .container {
                background-color: white;
            }
            h1 {
                text-align: right;
                color: #04394d;
                padding-bottom: 0.2em;
            }
            h2 {
                padding-bottom: 0.2ex;
            }
            th {
                padding-right: 2ex;
                padding-top: 0.75ex;
            }
            td {
                padding-bottom: 0.75ex;
            }
            .calc {
                background-color: #d2f3fe;
            }
            .buttonRow {
                text-align: right;
            }

            .calcPanel {
                background-color: #fafafa;
                padding-top: 1.1em;
                padding-bottom: 3em;
            }
            .afterCalculate {
                padding-top: 2em;
            }

            .balloonPanel {
                background-color: #eee;
                padding-top: 1.1em;
                padding-bottom: 3em;
            }

            .conditionsPanel {
                background-color: #ddd;
                padding-top: 1.1em;
                padding-bottom: 3em;
            }

            .createdByPanel {
                background-color: #ccc;
                text-align: center;
                padding-right: 2ex;
                padding-left: 2ex;
                padding-top: 2em;
                padding-bottom: 2em;
            }

            #totalMass, 
            #lsAirDensity, 
            #ambientAirDensity,
            #launchVolume,
            #freeLiftKg,
            #ballastDurationCapacity,
            #ballastRemaining {
                background-color: #ddd;
            }
        </style>

        <script src="js/lib/jquery-2.1.3.js"></script>        
        <script src="js/lib/bootstrap-3.3.2-custom.js"></script>

        <script src="js/main.js"></script>
        <script>
        var updateView = function () {

            var totalMass = (parseFloat($("#mass1").val()) +
                parseFloat($("#mass2").val()) +
                parseFloat($("#mass3").val())) / 1000; // kg

            var rSpecificLiftingGas = parseFloat($("#rSpecificLiftingGas").val());
            if (rSpecificLiftingGas <= 0) {
                rSpecificLiftingGas = 2077; // For Helium
                $("#rSpecificLiftingGas").val(2077);
            }

            var params = {
                vehicle: {
                    mass: {
                        balloonEnvelope: parseFloat($("#mass1").val()),
                        flightSystem: parseFloat($("#mass2").val()),
                        ballast: parseFloat($("#mass3").val())
                    },
                    balloonDrag: parseFloat($("#balloonDrag").val()),
                    rSpecificLiftingGas: rSpecificLiftingGas,
                    ballastReleaseRate: parseFloat($("#ballastReleaseRate").val()),
                    valve: {
                        neckTubeInletDiameter: parseFloat($("#neckTubeInletDiameter").val())
                    }
                },
                launch: {
                    pressure: parseFloat($("#lsPressure").val()),
                    temperature: parseFloat($("#lsTemperature").val()),
                    balloon: {
                        diffPressure: parseFloat($("#lsBalloonDiffPressure").val()),
                        gasTemperature: parseFloat($("#lsBalloonGasTemperature").val()),
                    }
                },
                ascentRateTarget: parseFloat($("#ascentRateTarget").val()),
                target: {
                    pressure: parseFloat($("#ambientPressure").val()),
                    temperature: parseFloat($("#ambientTemperature").val()),
                    balloon: {
                        diffPressure: parseFloat($("#ambientBalloonDiffPressure").val()),
                        gasTemperature: parseFloat($("#ambientBalloonGasTemperature").val())
                    }
                }
            };

            var calc = SAW.BalloonViewModel(params);

            $("#ascent").text(calc.launch.gasMass.toFixed(3));
            $("#neutral").text(calc.neutral.gasMass.toFixed(3));
            $("#time").text(calc.time.toFixed(0));
            
            var dropTime = parseFloat($("#ballastDropInSeconds").val());
            
            $("#ballastRemaining").text(calc.launch.ballastAfterBallastDrop(dropTime).toFixed(0));
            $("#postBallastDropAscentRate").text(calc.launch.ascentRateAfterBallastDrop(dropTime).toFixed(1));
            $("#targetAmbientPressure").text(calc.neutral.ambientPressureAfterBallastDrop(dropTime).toFixed(0));

            $("#launchVolume").text(calc.launch.launchVolume.toFixed(3));
            $("#freeLiftKg").text(calc.launch.freeLiftKg.toFixed(4));
            // This is no longer needed. Leave here for a little in case we change
            // our minds. May 28, 2015.
            // $("#ballastDurationCapacity").text(calc.launch.ballastDurationCapacity.toFixed(4));

            $("#totalMass").text(totalMass);
            
            $("#lsAirDensity").text(calc.launch.airDensity.toFixed(4));
            $("#ambientAirDensity").text(calc.neutral.airDensity.toFixed(4));
            
        };

        $(function () {
            var fieldsToUpdateOnChange = [ 
                'mass1',
                'mass2',
                'mass3', 
                
                'neckTubeInletDiameter',
                'balloonDrag',
                'rSpecificLiftingGas',
                'ballastReleaseRate',
                
                'lsPressure',
                'lsTemperature',
                'lsBalloonDiffPressure',
                'lsBalloonGasTemperature',
                
                'ascentRateTarget',
                'ballastDropInSeconds',
                
                'ambientPressure',
                'ambientTemperature',
                'ambientBalloonDiffPressure',
                'ambientBalloonGasTemperature'];

            for (var index in fieldsToUpdateOnChange) {
                $("#" + fieldsToUpdateOnChange[index]).change(updateView);
            }

            $("#calcButton").click(updateView);

            updateView();
        });
        </script>
    </head>
    
    <div id="calculator" class="container">
        <h1>Smith &amp; Williamson</h1>

        <div class="row calcPanel">
            <div class="col-md-6 col-xs-12">
                <h2>Calculations</h2>
                <table>
                    <tr>
                        <th><label>Ascent rate helium mass</label></th>
                        <td>
                            <div class="input-group">
                                <span class="form-control calc" id="ascent"></span>
                                <div class="input-group-addon">kg</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label>Neutral lift helium mass</label></th>
                        <td>
                            <div class="input-group">
                                <span class="form-control calc" id="neutral"></span>
                                <div class="input-group-addon">kg</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label>Launch volume</label></th>
                        <td>
                            <div class="input-group">
                                <span class="form-control calc" id="launchVolume"></span>
                                <div class="input-group-addon">m<sup>3</sup></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label>Launch free lift</label></th>
                        <td>
                            <div class="input-group">
                                <span class="form-control calc" id="freeLiftKg"></span>
                                <div class="input-group-addon">kg</div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="col-md-6 col-xs-12">
                <h2>Ascent targets</h2>
                <table>
                    <tr>
                        <th>&nbsp;</th>
                        <td class="buttonRow"><button id="calcButton" class="btn btn-default">Calculate</button></td>
                    </tr>
                    <tr>
                        <th><label for="ascentRateTarget">Initial ascent rate</label></th>
                        <td>
                            <div class="input-group">
                                <input id="ascentRateTarget" class="form-control"  
                                    type="number" min="0" value="4.5" step="0.1"/>
                                <div class="input-group-addon">m/s</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label>Vent time for target altitude</label></th>
                        <td>
                            <div class="input-group">
                                <span class="form-control calc" id="time"></span>
                                <div class="input-group-addon">s</div>
                            </div>
                        </td>
                    </tr>
                    
                    <tr>
                        <th class="afterCalculate"><label for="ballastDropInSeconds">Ballast drop in seconds</label></th>
                        <td class="afterCalculate">
                            <div class="input-group">
                                <input id="ballastDropInSeconds" class="form-control"  
                                    type="number" min="0" value="0"/>
                                <div class="input-group-addon">s</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="targetAmbientPressure">Target ambient pressure</label></th>
                        <td>
                            <div class="input-group">
                                <div id="targetAmbientPressure" class="form-control calc"></div>  
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="postBallastDropAscentRate">Post ballast drop ascent rate</label></th>
                        <td>
                            <div class="input-group">
                                <div id="postBallastDropAscentRate" class="form-control calc"></div>  
                                <div class="input-group-addon">m/s</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ballastRemaining">Ballast remaining</label></th>
                        <td>
                            <div class="input-group">
                                <div id="ballastRemaining" class="form-control"></div>  
                                <div class="input-group-addon">g</div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>



        <div class="row balloonPanel">
            <h2 class="col-xs-12">Flight system properties</h2>
            <div class="col-xs-12 col-sm-6">
                <table>
                    <tr>
                        <th><label for="mass1">Balloon envelope mass</label></th>
                        <td>
                            <div class="input-group">
                                <input id="mass1" type="number" min="0" value="300" class="form-control"/>
                                <div class="input-group-addon">g</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="mass2">Flight system &amp; payload mass</label></th>
                        <td>
                            <div class="input-group">
                                <input id="mass2" type="number" min="0" value="1090" class="form-control"/>
                                <div class="input-group-addon">g</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="mass3">Ballast mass</label></th>
                        <td>
                            <div class="input-group">
                                <input id="mass3" type="number" min="0" value="630" class="form-control"
                                />
                                <div class="input-group-addon">g</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="totalMass">Total launch mass</label></th>
                        <td>
                            <div class="input-group">
                                <span id="totalMass" class="form-control"></span>
                                <div class="input-group-addon">kg</div>
                            </div>
                        </td>
                    </tr>
<!--                     <tr>
                        <th><label for="valveDiameter">Valve tube inlet diameter</label></th>
                        <td>
                            <div class="input-group">
                                <input id="valveDiameter" type="number" value="0.03" class="form-control"
                                />
                                <div class="input-group-addon">m</div>
                            </div>
                        </td>
                    </tr>
 -->                </table>
            </div>
            
            <div class="col-xs-12 col-sm-6">
                <table>
                    <tr>
                        <th><label for="balloonDrag">Balloon drag, C<sub>d</sub></label></th>
                        <td>
                            <div class="input-group">
                                <input id="balloonDrag" type="number" min="0" max="2" step="0.01" value="0.25" class="form-control"/>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="neckTubeInletDiameter">Neck tube inlet diameter</label></th>
                        <td>
                            <div class="input-group">
                                <input id="neckTubeInletDiameter" type="number" min="0" step="0.001" value="0.030" class="form-control"/>
                                <div class="input-group-addon">m</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="rSpecificLiftingGas">Lift gas Rspecific</label></th>
                        <td>
                            <div class="input-group">
                                <input id="rSpecificLiftingGas" type="number" min="0" max="5000" value="2077" class="form-control"/>
                                <div class="input-group-addon">J/Kg K</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ballastReleaseRate">Ballast release rate</label></th>
                        <td>
                            <div class="input-group">
                                <input id="neckTubeInletDiameter" type="number" min="0" max="100" step="0.01" value="5.25" class="form-control"/>
                                <div class="input-group-addon">g/s</div>
                            </div>
                        </td>
                    </tr>
<!-- This is no longer wanted. Leave it here for a little in case our minds change. May 28, 2015
                   <tr>
                        <th><label for="ballastDurationCapacity">Ballast duration capacity</label></th>
                        <td>
                            <div class="input-group">
                                <span id="ballastDurationCapacity" class="form-control"></span>
                                <div class="input-group-addon">s</div>
                            </div>
                        </td>
                    </tr>-->
                </table>
            </div>
        </div>

        <div class="row">
        </div>


        <div class="row conditionsPanel">
            <div class="col-md-6 col-xs-12">
                <h2>Launch site conditions</h2>
                <table>
                    <tr>
                        <th><label for="lsPressure">Pressure</label></th>
                        <td>
                            <div class="input-group">
                                <input id="lsPressure" class="form-control"  
                                    type="number" min="0" value="101000"/>
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <th><label for="lsTemperature">Temperature</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="lsTemperature" 
                                    type="number" min="0" value="283"/>
                                <div class="input-group-addon">K</div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <th><label for="lsAirDensity">Air density</label></th>
                        <td>
                            <div class="input-group">
                                <span id="lsAirDensity" class="form-control"></span>
                                <div class="input-group-addon">kg/m<sup>3</sup></div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <th><label for="lsBalloonDiffPressure">Balloon diff pressure</label></th>
                        <td>
                            <div class="input-group">
                                <input id="lsBalloonDiffPressure" class="form-control"  
                                    type="number" min="0" value="133"/>
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <th><label for="lsBalloonGasTemperature">Balloon gas temperature</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="lsBalloonGasTemperature" 
                                    type="number" min="0" value="283"/>
                                <div class="input-group-addon">K</div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="col-xs-12 col-md-6">
                <h2>Target altitude conditions</h2>
                <table>
                    <tr>
                        <th><label for="ambientPressure">Pressure</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="ambientPressure" 
                                    type="number" min="0" value="10343"/>
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ambientTemperature">Temperature</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="ambientTemperature" 
                                    type="number" min="0" value="221"/>
                                <div class="input-group-addon">K</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ambientAirDensity">Air density</label></th>
                        <td>
                            <div class="input-group">
                                <span id="ambientAirDensity" class="form-control"></span>
                                <div class="input-group-addon">kg/m<sup>3</sup></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ambientBalloonDiffPressure">Balloon diff pressure</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="ambientBalloonDiffPressure" 
                                    type="number" min="0" value="150"/>
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ambientBalloonGasTemperature">Balloon gas temperature </label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="ambientBalloonGasTemperature" 
                                    type="number" min="0" value="223"/>
                                <div class="input-group-addon">K</div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12 createdByPanel">
                <p>Created in Corvallis, Oregon</p>
            </div>
        </div>
    </div>
</html>