<html>
    <head>
        <link rel="stylesheet" href="css/bootstrap-3.3.2-custom.css"/>
        <link rel="stylesheet" href="css/bootstrap-theme-3.3.2-custom.css"/>
        <style>
            body {
                background-color: #04394d;
            }
            .container {
                background-color: white;
            }
            h1 {
                text-align: right;
                color: #04394d;
            }
            h2 {
                padding-bottom: 0.2ex;
            }
            th {
                padding-right: 2ex;
                padding-top: 0.75ex;
            }
            td {
                padding-bottom: 0.75ex;
            }
            .calc {
                background-color: #d2f3fe;
            }
            .buttonRow {
                text-align: right;
            }

            .calcPanel {
                background-color: #fafafa;
                padding-top: 1.1em;
                padding-bottom: 3em;
            }

            .balloonPanel {
                background-color: #eee;
                padding-top: 1.1em;
                padding-bottom: 3em;
            }

            .conditionsPanel {
                background-color: #ddd;
                padding-top: 1.1em;
                padding-bottom: 3em;
            }

            #totalMass {
                background-color: #ddd;
            }
        </style>

        <script src="js/lib/react-0.12.2.js"></script>
        <script src="js/lib/JsxTransformer-0.12.2.js"></script>

        <script src="js/lib/jquery-2.1.3.js"></script>        
        <script src="js/lib/bootstrap-3.3.2-custom.js"></script>

        <script src="js/main.js"></script>
        <script>
        var updateView = function () {

            var totalMass = (parseFloat($("#mass1").val()) +
                parseFloat($("#mass2").val()) +
                parseFloat($("#mass3").val())) / 1000; // kg

            var params = {
                vehicle: {
                    mass: totalMass,
                    valve: {
                        neckTubeInletDiameter: parseFloat($("#valveDiameter").val())
                    }
                },
                launch: {
                    pressure: parseFloat($("#lsPressure").val()),
                    temperature: parseFloat($("#lsTemperature").val()),
                    balloon: {
                        diffPressure: parseFloat($("#lsBalloonDiffPressure").val()),
                        gasTemperature: parseFloat($("#lsBalloonGasTemperature").val())
                    }
                },
                ascentRateTarget: parseFloat($("#ascentRateTarget").val()),
                target: {
                    pressure: parseFloat($("#ambientPressure").val()),
                    temperature: parseFloat($("#ambientTemperature").val()),
                    balloon: {
                        diffPressure: parseFloat($("#ambientBalloonDiffPressure").val()),
                        gasTemperature: parseFloat($("#ambientBalloonGasTemperature").val())
                    }
                }
            };

            console.log(params);

            var calc = SAW.BalloonViewModel(params);

            $("#ascent").text(calc.launch.toFixed(4));
            $("#neutral").text(calc.neutral.toFixed(4));
            $("#time").text(calc.time.toFixed(4));

            $("#totalMass").text(totalMass);
        };

        $(function () {
            var fieldsToUpdateOnChange = [ 
                'mass1',
                'mass2',
                'mass3', 
                'valveDiameter',
                'lsPressure',
                'lsTemperature',
                'lsBalloonDiffPressure',
                'lsBalloonGasTemperature',
                'ascentRateTarget',
                'ambientPressure',
                'ambientTemperature',
                'ambientBalloonDiffPressure',
                'ambientBalloonGasTemperature'];

            for (var index in fieldsToUpdateOnChange) {
                $("#" + fieldsToUpdateOnChange[index]).change(updateView);
            }

            $("#calcButton").click(updateView);

            updateView();
        });
        </script>
    </head>
    
    <div id="calculator" class="container">
        <h1>Smith &amp; Williamson</h1>

        <div class="row calcPanel">
            <div class="col-md-6 col-xs-12">
                <h2>Calculations</h2>
                <table>
                    <tr>
                        <th><label>Ascent rate helium mass</label></th>
                        <td>
                            <div class="input-group">
                                <span class="form-control calc" id="ascent"></span>
                                <div class="input-group-addon">kg</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label>Neutral lift helium mass</label></th>
                        <td>
                            <div class="input-group">
                                <span class="form-control calc" id="neutral"></span>
                                <div class="input-group-addon">kg</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label>Vent time for stable float</label></th>
                        <td>
                            <div class="input-group">
                                <span class="form-control calc" id="time"></span>
                                <div class="input-group-addon">s</div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="col-md-6 col-xs-12">
                <h2>Targets</h2>
                <table>
                    <tr>
                        <th><label for="ascentRateTarget">Initial ascent rate</label></th>
                        <td>
                            <div class="input-group">
                                <input id="ascentRateTarget" class="form-control"  
                                    type="number" value="4.5"/>
                                <div class="input-group-addon">m/s</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>&nbsp;</th>
                        <td class="buttonRow"><button id="calcButton" class="btn btn-default">Calculate</button></td>
                    </tr>
                </table>
            </div>
        </div>



        <div class="row balloonPanel">
            <div class="col-xs-12">
                <h2>Balloon properties</h2>
                <table>
                    <tr>
                        <th><label for="mass1">Balloon envelope mass</label></th>
                        <td>
                            <div class="input-group">
                                <input id="mass1" type="number" value="300" class="form-control"/>
                                <div class="input-group-addon">g</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="mass2">Flight system (including payload) mass</label></th>
                        <td>
                            <div class="input-group">
                                <input id="mass2" type="number" value="1090" class="form-control"/>
                                <div class="input-group-addon">g</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="mass3">Ballast mass</label></th>
                        <td>
                            <div class="input-group">
                                <input id="mass3" type="number" value="630" class="form-control"
                                />
                                <div class="input-group-addon">g</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="totalMass">Total mass</label></th>
                        <td>
                            <div class="input-group">
                                <span id="totalMass" class="form-control"></span>
                                <div class="input-group-addon">kg</div>
                            </div>
                        </td>
                    </tr>
<!--                     <tr>
                        <th><label for="valveDiameter">Valve tube inlet diameter</label></th>
                        <td>
                            <div class="input-group">
                                <input id="valveDiameter" type="number" value="0.03" class="form-control"
                                />
                                <div class="input-group-addon">m</div>
                            </div>
                        </td>
                    </tr>
 -->                </table>
            </div>
        </div>

        <div class="row">
        </div>


        <div class="row conditionsPanel">
            <div class="col-md-6 col-xs-12">
                <h2>Launch site conditions</h2>
                <table>
                    <tr>
                        <th><label for="lsPressure">Pressure</label></th>
                        <td>
                            <div class="input-group">
                                <input id="lsPressure" class="form-control"  
                                    type="number" value="101000"/>
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <th><label for="lsTemperature">Temperature</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="lsTemperature" 
                                    type="number" value="283"/>
                                <div class="input-group-addon">K</div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <th><label for="lsBalloonDiffPressure">Balloon diff pressure</label></th>
                        <td>
                            <div class="input-group">
                                <input id="lsBalloonDiffPressure" class="form-control"  
                                    type="number" value="133"/>
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <th><label for="lsBalloonGasTemperature">Balloon gas temperature</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="lsBalloonGasTemperature" 
                                    type="number" value="283"/>
                                <div class="input-group-addon">K</div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="col-xs-12 col-md-6">
                <h2>Ambient conditions at altitude</h2>
                <table>
                    <tr>
                        <th><label for="ambientPressure">Pressure</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="ambientPressure" 
                                    type="number" value="10343"/>
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ambientTemperature">Temperature</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="ambientTemperature" 
                                    type="number" value="221"/>
                                <div class="input-group-addon">K</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ambientBalloonDiffPressure">Balloon diff pressure</label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="ambientBalloonDiffPressure" 
                                    type="number" value="150"/>
                                <div class="input-group-addon">Pa</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="ambientBalloonGasTemperature">Balloon gas temperature </label></th>
                        <td>
                            <div class="input-group">
                                <input class="form-control" id="ambientBalloonGasTemperature" 
                                    type="number" value="223"/>
                                <div class="input-group-addon">K</div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="example"></div>
    </div>
    
    
    <script type="text/jsx">
        // var SystemInput = React.createClass({
        //     getInitialState: function() {
        //         return {value: 101000};
        //     },
        //     checkValid: function (event) {
        //         console.log(event.target.value);
        //         return false;
        //     },
        //     handleChange: function(event) {
        //         this.setState({value: event.target.value});
        //     },
        //     render: function() {
        //         var value = this.state.value;
        //         return <input id="lsPressure" 
        //             type="number" value={value} 
        //             onChange={this.handleChange} 
        //             isValid={this.checkValid}/>;
        //     }
        // });
         

        // React.render(
        //   <SystemInput />,
        //   document.getElementById('lsPressureReact')
        // );
    </script>
</html>